{% extends 'base.html.twig' %}

{% block title %}Gestion Utilisateur{% endblock %}

{% block body %}
<header>{% include "/layout/navbar.html.twig" %}</header>
<nav>{% include "/layout/operations_nav.html.twig" %}</nav>
<div class="container pt-3">
    <h1 class="text-center">Gestion Utilisateur</h1>
    <br><br>
    {% include "layout/_flash_message.html.twig" %}
    <br>
    {# Lien d'ajout d'un nouvel utilisateur #}

<a href={{path('app_gestion_utilisateur_create')}} class="btn btn-outline-success">Ajouter un utilisateur</a>
<br><br>
    <table class="table table-bordered table-striped text-center">
        <tr>
            <th>Nom</th>
            <th>Prenom</th>
            <th>Username</th>
            <th>RÃ´le</th>
            <th>Action</th>
        </tr>
    {% for user in users %}
    <tr>
        <td>{{user.nom}}</td>
        <td>{{user.prenom}}</td>
        <td>{{user.username}}</td>

        {# D'apres le role attribuer a l'utilisateur on lui donne ce nom #}
        <td>
            {% if ('ROLE_EXPERT' in user.roles) %}
            <span id="colEx">Expert</span>
        {% elseif ('ROLE_SENIOR' in user.roles) %}
            <span id="colSe">Senior</span>
        {% else %}
            <span id="colAp">Apprenti</span>
            
        {% endif %}
    </td>
        <td class="w-25">
            <div class="d-flex align-items-center justify-content-around">
                <div>
                    {# <a href="{{path('app_gestion_utilisateur_modifF' , {'id':user.id}) }}" class="btn btn-outline-warning">Modifier Utilisateur</a> #}
                    {# <button type="button" class="btn btn-outline-warning" data-toggle="modal" data-target="#modalModif{{ user.id }}">Modifier</button> #}
                    <button type="button" class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#exampleModal{{user.id}}">
                        Modifier Utilisateur
                      </button>
                </div>
                    <div>

                    {% if ("ROLE_EXPERT" in user.roles) == false %}

                    <a onclick="return confirm('Voulez-vous vraiment supprimer cet utilisateur ?')" href="{{path('app_gestion_utilisateur_remove' , {'id':user.id}) }}" class="btn"><img src="/images/icons/suppr.svg" alt="icone suppr" width="85%"></a>

                    {% endif %}

                    </div>
        </div>
        </td>
        
    </tr>
    {% endfor %}
    </table>

<!-- Modal -->

{% for user in users %}
<div class="modal fade" id="exampleModal{{user.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Modifier Utilisateur</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            {{form_start(form)}}
            {{ form_widget(form.nom, { 'value': user.nom }) }}
            {{ form_widget(form.prenom, { 'value': user.prenom }) }}
            {{ form_widget(form.username, { 'value': user.username }) }}
            {{form_widget(form.roles)}}
            <input type="submit" value="Modifier">
            {{form_end(form)}}
            
        </div>
      </div>
    </div>
    
  </div>
{% endblock %}
  {% endblock %}

